<div class="body" [ngClass]="{'body-dark':isDarkTheme}">


  <!-- Header -->
<header class="header" [ngClass]="{'header-dark':isDarkTheme}">
  <div class="logo" (click)="return()" translate="no">My-Bank</div>
  <div class="header-actions" [ngClass]="{'header-actions-dark':isDarkTheme}">
    <button *ngIf="isDarkTheme == true" class="theme-toggle" [ngClass]="{'theme-toggle-dark':isDarkTheme}" (click)="toggleTheme()">
      <svg
        class="sun"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <circle cx="12" cy="12" r="5" />
        <line x1="12" y1="1" x2="12" y2="3" />
        <line x1="12" y1="21" x2="12" y2="23" />
        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
        <line x1="1" y1="12" x2="3" y2="12" />
        <line x1="21" y1="12" x2="23" y2="12" />
        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
      </svg>
    </button>

    <button *ngIf="isDarkTheme == false" class="theme-toggle" [ngClass]="{'theme-toggle-dark':isDarkTheme}" (click)="toggleTheme()">
      <svg
        class="moon"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z" />
      </svg>
    </button>

    <div class="profile-icon"
    [ngClass]="{'profile-icon-dark':isDarkTheme}"
    (click)="openSideBarNotifications()"
    *ngIf="admin == false">
      <svg
        class="sino"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9"/>
        <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
      </svg>
      <span *ngIf=" notificationCount > 0 && notificationCount < 10">{{ notificationCount }}</span>
      <span *ngIf="notificationCount >= 10">9+</span>
    </div>

    <div class="profile-icon"
    [ngClass]="{'profile-icon-dark':isDarkTheme}"
    (click)="openSidebarMenu = !openSidebarMenu">

    <svg
      class="menu-icon"
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round">

      <line x1="3" y1="6" x2="21" y2="6" />
      <line x1="3" y1="12" x2="21" y2="12" />
      <line x1="3" y1="18" x2="21" y2="18" />
    </svg>

  </div>
  </div>
</header>



  <!-- Sidebar -->
  <div class="sidebar" [ngClass]="{'sidebar-open': openSidebarMenu}">
    <div class="sidebar-header">
      <h2 class="sidebar-title">Menu</h2>
    </div>
    <nav class="sidebar-nav">
      <ul class="sidebar-list">
        <li>
          <button class="sidebar-item" (click)="redirectForConfiguration()">
            <svg class="sidebar-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            <span>Configuration</span>
          </button>
        </li>
        <li *ngIf="!clientIsVerified && admin == false">
          <button type="button" class="sidebar-item" (click)="QrCode()">
            <svg class="sidebar-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
            </svg>
            <span>Validation</span>
          </button>
        </li>
        <li>
          <button type="button" class="sidebar-item" (click)="logout()">
            <svg class="sidebar-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
            </svg>
            <span>Exit</span>
          </button>
        </li>
      </ul>
    </nav>
    <div class="sidebar-footer">
      <button class="close-button" (click)="openSidebarMenu = !openSidebarMenu">Close</button>
    </div>
  </div>
  <!---->

  <!--Side bar notificação-->
  <div class="sidebar-notification" [ngClass]="{'sidebar-notification-open': openSideBarNotification}">
    <div>
      <h2 class="sidebar-card-notification-title">Notifications</h2>
    </div>
    <nav class="sidebar-nav">
      <ul class="sidebar-list">
        <li>
          <div style="display: flex; justify-content: center; text-align: center;"
                *ngFor="let notification of notifications, let id = index">
            <div class="sidebar-card-notification">
              <div>
                <p
                class="sidebar-card-notification-close"
                (click)="occultNotification(notification.notificationId)">X</p>
                <p style="font-size: 18px;">{{notification.message}}</p>
                <p style="font-size: 12px; margin: 10px 0px 10px 0px;">{{notification.timestamp}}</p>
              </div>
            </div>
          </div>
        </li>
      </ul>
    </nav>

    <div class="sidebar-footer">
      <button class="close-button" (click)="closeSideBarNotification()">Close</button>
    </div>
  </div>
  <!---->

  <!-- Overlay -->
  <div class="overlay" *ngIf="openSidebarMenu" (click)="openSidebarMenu = !openSidebarMenu"></div>
  <div class="overlay" *ngIf="openSideBarNotification" (click)="closeSideBarNotification()"></div>
  <!---->


<header class="header2" [ngClass]="{'header2-dark' : isDarkTheme}">
  <div>
    <h5>Welcome: {{user.fullName.split(' ')[0]}} {{user.fullName.split(' ')[1].charAt(0)}}.</h5>
  </div>
</header>

<!-- Main Content -->

<div class="main-content" [ngClass]="{'main-content-dark':isDarkTheme}">
    <div class="flex-money" [ngClass]="{'flex-money-dark':isDarkTheme}">

      <div *ngIf="buttonsOfPayment[0].pressed" style="display: flex; justify-content: space-between;">
        <div>
          <h3>Available balance :</h3>
        </div>
        <div>
          <h2>R$ {{ money.toFixed(2) }}</h2>
        </div>
      </div>

      <div *ngIf="buttonsOfPayment[1].pressed" style="display: flex; justify-content: space-between;">
        <div>
          <h3>Available limit credit :</h3>
        </div>
        <div>
          <h2>R$: {{ (limitOfCredit || 0).toFixed(2) }}</h2>
        </div>
      </div>
    </div>
    <div class="flex-container">

        <!-- Left Side - Payment Forms -->
        <div class="payment-form">
            <!-- Tabs -->
            <div class="tabs" [ngClass]="{'tabs-dark':isDarkTheme}">

              <button class="tabs-button"
                *ngFor="let button of buttons"
                (click)="toggleButton(button.id)"
                [ngClass]="{'active': button.pressed}">
                {{button.name}}
              </button>

            </div>

            <!-- Send Money Form -->
            <div class="form-container" [ngClass]="{'form-container-dark': isDarkTheme}" *ngIf="buttons[0].pressed">

                <h2 class="form-title">Send Money</h2>

                <div *ngIf="payPix">

                  <form method="post" (ngSubmit)="payment()" [formGroup]="paymentForm">
                    <div class="form-group">
                      <label class="form-label">Value</label>
                      <div class="input-with-icon">
                          <input type="number" formControlName="money" class="form-input amount-input" [ngClass]="{'form-input-dark':isDarkTheme}" placeholder="0,00">
                      </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">For</label>
                        <div class="input-with-icon">
                            <input type="text" formControlName="key" class="form-input amount-input" [ngClass]="{'form-input-dark':isDarkTheme}" placeholder="Enter a key">
                        </div>
                    </div>

                    <label class="form-label">Methods of payment</label>
                    <div style="display: flex; justify-content: center; gap: 10px;">
                      <div class="payment-methods"
                        *ngFor="let button_payment of buttonsOfPayment"
                        (click)="toggleButtonOfPayment(button_payment.id)">
                        <button type="button">{{button_payment.name}}</button>
                      </div>
                    </div>


                    <button type="button" (click)="confirmPayment = !confirmPayment" class="submit-button">Continue</button>

                    <div *ngIf="confirmPayment && buttonsOfPayment[0].pressed" class="confirm-payment-overley">
                      <div class="confirm-payment" [ngClass]="{'confirm-payment-dark':isDarkTheme}">
                        <p class="close-confirm-payment" (click)="confirmPayment = !confirmPayment">X</p>
                        <h2>Confirm your payment</h2>
                        <p class="confirm-payment-info">You want to send the value: <span>R$ {{ paymentForm.value.money.toFixed(2) }}</span>
                          to the key: <span>{{ paymentForm.value.key }}</span></p>

                        <div style="display: flex; justify-content: center;">
                          <button type="submit">Confirm</button>
                        </div>
                      </div>
                    </div>

                    <div *ngIf="confirmPayment && buttonsOfPayment[1].pressed" class="confirm-payment-overley">

                      <div class="confirm-payment" [ngClass]="{'confirm-payment-dark':isDarkTheme}">
                        <p class="close-confirm-payment" (click)="confirmPayment = !confirmPayment">X</p>
                        <h2>Confirm your payment</h2>
                        <p class="confirm-payment-info">In credit is acrecented a fee of 5%</p>
                        <p class="confirm-payment-info">Value: <span> R$ {{ paymentForm.value.money.toFixed(2) }} -> R$ {{paymentForm.value.money + (paymentForm.value.money * 0.05 )}}</span></p>
                        <p class="confirm-payment-info">For: <span> {{ paymentForm.value.key }} </span></p>

                        <div style="display: flex; justify-content: center;">
                          <button type="submit">Confirm</button>
                        </div>
                      </div>

                    </div>

                  </form>

                </div>
            </div>


            <div class="form-container" [ngClass]="{'form-container-dark': isDarkTheme}" *ngIf="buttons[1].pressed">

                <h2 class="form-title">Pay bill</h2>

                <div class="form-group">
                    <label class="form-label">Value</label>
                    <div class="input-with-icon">
                        <input type="number" class="form-input amount-input" placeholder="0,00" [ngClass]="{'form-input-dark':isDarkTheme}">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Barcode</label>
                    <div class="input-with-icon">
                        <input type="text" class="form-input amount-input" placeholder="Enter a barcode" [ngClass]="{'form-input-dark':isDarkTheme}">
                    </div>
                </div>

                <label class="form-label">Methods of payment</label>
                <div style="display: flex; justify-content: center; gap: 10px;">
                  <div class="payment-methods"
                    *ngFor="let button_payment of buttonsOfPayment"
                    (click)="toggleButtonOfPayment(button_payment.id)">
                    <button type="button">{{button_payment.name}}</button>
                  </div>
                </div>

                <button class="submit-button">Continue</button>
            </div>

            <div class="form-container" [ngClass]="{'form-container-dark': isDarkTheme}" *ngIf="buttons[2].pressed && limitOfCredit != null">

                <h2 class="form-title">Credit limit</h2>

                <div class="form-credit-limit">
                  <p class="form-credit-limit-p1">Available limit: <span>R$ {{ limitOfCredit.toFixed(2) }}</span></p>
                  <p class="form-credit-limit-p2">Your credit limit is: <span>R$ {{ salary.toFixed(2) }}</span></p>
                </div>

                <form method="post" (ngSubmit)="creditPayment()" [formGroup]="creditPaymentForm">
                    <div class="form-group">
                        <label class="form-label">Value</label>
                        <div class="input-with-icon">
                            <input type="number" [min]="0" [max]="(salary - limitOfCredit).toFixed(2)" [ngClass]="{'form-input-dark':isDarkTheme}" class="form-input amount-input" formControlName="money"
                            placeholder="Enter a value between R$: 0.00 and R$: {{(salary - limitOfCredit).toFixed(2)}}">
                        </div>
                    </div>

                    <button type="button" (click)="confirmCreditPayment = !confirmCreditPayment" class="submit-button">Continue</button>

                    <div *ngIf="confirmCreditPayment" class="confirm-payment-credit-overley">
                      <div class="confirm-payment-credit" [ngClass]="{'confirm-payment-credit-dark':isDarkTheme}">
                        <p class="close-confirm-payment-credit" (click)="confirmCreditPayment = !confirmCreditPayment">X</p>
                        <h2>Confirm your payment</h2>
                        <p class="confirm-payment-info-credit">Are you sure you want to pay to gain credit limit?</p>

                        <div style="display: flex; justify-content: center;">
                          <button type="submit">Confirm</button>
                        </div>
                      </div>
                    </div>
                </form>
            </div>

            <div class="card" [ngClass]="{'card-dark':isDarkTheme}" *ngIf="buttons[3].pressed">

              <div class="card-header">
                  <h3 class="card-title">Hystory of transactions</h3>
              </div>

              <div class="search-group">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="search-icon">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
                <input type="text" placeholder="Search users..." class="search-input"
                [(ngModel)]="searchTerm"
                (ngModelChange)="currentPage = 1"
                [ngClass]="{'search-input-dark':isDarkTheme}">
              </div>

              <div class="recent-payment" *ngFor="let payment of paginatedPayments">

                <div class="payment-info">
                    <div class="payment-avatar">{{payment.fullName.split(' ')[0].charAt(0)}}</div>
                    <div class="payment-details">
                        <h3>{{payment.fullName.split(' ')[0]}}</h3>
                        <p>{{payment.timeStamp}}</p>
                    </div>
                </div>
                <div class="payment-amount"
                [ngClass]="{'text-danger': payment.sendOrReceive === 'SEND', 'text-success': payment.sendOrReceive === 'RECEIVE',
                'text-danger-dark': payment.sendOrReceive === 'SEND' && isDarkTheme, 'text-success-dark': payment.sendOrReceive === 'RECEIVE' && isDarkTheme}">
                    <h4>
                      <span>{{ payment.sendOrReceive === 'SEND' ? '-' : '+' }}</span>
                      {{payment.money.toFixed(2)}}
                    </h4>
                    <p>pix</p>
                </div>
              </div>

              <div class="pagination" [ngClass]="{'pagination-dark':isDarkTheme}">
                <button class="pagination-btn" (click)="previousPage()" [disabled]="currentPage === 1">Previous</button>
                <span class="pagination-info">Page {{ currentPage }} of {{ totalPages }}</span>
                <button class="pagination-btn primary" (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
              </div>

            </div>
        </div>

        <!-- Right Side - Cards -->
        <div class="cards-container" *ngIf="!buttons[3].pressed">
            <!-- Recent Payments -->
            <div class="card" [ngClass]="{'card-dark':isDarkTheme}">
                <div class="card-header">
                    <h3 class="card-title">Recent payments</h3>
                </div>
                <div class="recent-payment" *ngFor="let payment of allPayments.slice(0,5)">

                  <div class="payment-info">
                      <div class="payment-avatar" *ngIf="payment.userReceive == null">Me</div>
                      <div class="payment-avatar" *ngIf="payment.userReceive != null">{{payment.fullName.split(' ')[0].charAt(0)}}</div>
                      <div class="payment-details">
                          <h3 *ngIf="payment.userReceive == null">Me</h3>
                          <h3 *ngIf="payment.userReceive != null">{{payment.fullName.split(' ')[0]}}</h3>
                          <p>{{payment.timeStamp}}</p>
                      </div>
                  </div>
                  <div class="payment-amount"
                  [ngClass]="{'text-danger': payment.sendOrReceive === 'SEND', 'text-success': payment.sendOrReceive === 'RECEIVE',
                  'text-danger-dark': payment.sendOrReceive === 'SEND' && isDarkTheme, 'text-success-dark': payment.sendOrReceive === 'RECEIVE' && isDarkTheme}">
                      <h4>
                        <span>{{ payment.sendOrReceive === 'SEND' ? '-' : '+' }}</span>
                        {{payment.money.toFixed(2)}}
                      </h4>
                      <p>pix</p>
                  </div>

                </div>
            </div>
        </div>
    </div>
</div>


</div>
